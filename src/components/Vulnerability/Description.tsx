import { useContext, useState } from "react";
import "../../styles/Vulnerability/Description.scss";
import { AccordionContext } from "./VulnerabilityAccordion";
import MDEditor from '@uiw/react-md-editor';
import download from "downloadjs";
import classNames from "classnames";
import { Card, IVulnerabilityData } from "./types";
import { Colors } from "constants/constants";
import { useTranslation } from "react-i18next";

interface IProps {
  cards: IVulnerabilityData
}

export default function Description(props: IProps) {
  const { t } = useTranslation();
  const { cards } = props;
  const [title, setTitle] = useState(cards.description.title);
  const [description, setDescription] = useState(cards.description.description);
  const { submitCard } = useContext(AccordionContext);
  const textToDownload = `
  **Project Name:** ${cards.project.projectName}
  **Title:** ${title}
  **Description:** ${description}
  **Telegram username:** ${cards.contact.username}
  **Beneficiary:** ${cards.contact.beneficiary}
  `;

  const editorStyles = {
    color: Colors.white
  }

  return (
    <div className="description-wrapper">
      <input className={classNames({ "input-error": title === "" })} autoFocus type="text" placeholder="Title" onChange={(e) => setTitle(e.target.value)} value={title} />
      <MDEditor
        className={classNames({ "input-error": description === "" })}
        style={editorStyles}
        value={description}
        onChange={value => setDescription(value!)}
      />

      <button
        className="save-and-download-btn"
        disabled={title === "" || description === ""}
        onClick={() => {
          submitCard(Card.description, Card.terms, { title: title, description: description });
          download(textToDownload, `${title}.md`);
        }}>{t("Description.save-and-download")}</button>
    </div>
  )
}
