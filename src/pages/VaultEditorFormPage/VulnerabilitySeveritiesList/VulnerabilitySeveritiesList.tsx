import { useFieldArray, useWatch } from "react-hook-form";
import { useTranslation } from "react-i18next";
import { useEnhancedFormContext } from "hooks/useEnhancedFormContext";
import { FormInput } from "components";
import { IEditedVaultDescription } from "../types";
import VulnerabilitySeverityForm from "./VulnerabilitySeverityForm/VulnerabilitySeverityForm";

export function VulnerabilitySeveritiesList() {
  const { t } = useTranslation();
  const { control, register } = useEnhancedFormContext<IEditedVaultDescription>();
  const { fields: severities, append, remove } = useFieldArray({ control, name: "vulnerability-severities-spec.severities" });

  const isV1 = useWatch({control, name: "version"}) === "v1";

  return (
    <>
      {isV1 && (
        <div>
          <FormInput
            {...register(`vulnerability-severities-spec.indexArray`)}
            label={t("VaultEditor.severities-index-array")}
            colorable
            placeholder={t("VaultEditor.severities-index-array-placeholder")}
          />
        </div>
      )}

      {severities.map((severity, index) => (
        <VulnerabilitySeverityForm key={severity.id} index={index} append={append} remove={remove} severitiesCount={severities.length} />
      ))}
    </>
  );
}
